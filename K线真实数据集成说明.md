# Kçº¿çœŸå®æ•°æ®é›†æˆè¯´æ˜

## ğŸ“ æ›´æ–°æ¦‚è§ˆ

æœ¬æ¬¡æ›´æ–°å°†Kçº¿å›¾çš„æ¨¡æ‹Ÿæ•°æ®æ›¿æ¢ä¸ºä»åŒèŠ±é¡ºAPIè·å–çš„çœŸå®æœŸè´§æ•°æ®ã€‚

## ğŸ¯ æ ¸å¿ƒæ”¹åŠ¨

### 1. æ–°å¢æ–‡ä»¶

#### `src/types/futures.ts` - TypeScriptç±»å‹å®šä¹‰
å®šä¹‰äº†æ‰€æœ‰APIç›¸å…³çš„æ•°æ®ç±»å‹ï¼š
- `MainContractDetail`: ä¸»åŠ›åˆçº¦è¯¦æƒ…
- `MainContractListResponse`: ä¸»åŠ›åˆçº¦åˆ—è¡¨APIå“åº”
- `KlineDataPoint`: Kçº¿æ•°æ®ç‚¹ï¼ˆChart.jsæ ¼å¼ï¼‰
- `KlineDataResponse`: Kçº¿æ•°æ®APIå“åº”
- `ContractMatchResult`: åˆçº¦åŒ¹é…ç»“æœ

#### `src/services/futuresApi.ts` - APIæœåŠ¡å±‚
å°è£…äº†æ‰€æœ‰åŒèŠ±é¡ºAPIè°ƒç”¨é€»è¾‘ï¼š

**æ ¸å¿ƒå‡½æ•°ï¼š**
- `getMainContractList()`: è·å–æ‰€æœ‰ä¸»åŠ›åˆçº¦åˆ—è¡¨
- `matchContract()`: æ ¹æ®åˆçº¦åç§°åŒ¹é…åˆçº¦ä¿¡æ¯
- `fetchKlineData()`: è·å–Kçº¿æ•°æ®
- `transformKlineData()`: è½¬æ¢æ•°æ®æ ¼å¼
- `getKlineDataByContractName()`: å®Œæ•´æµç¨‹ï¼ˆæ¨èä½¿ç”¨ï¼‰
- `checkApiHealth()`: APIå¥åº·æ£€æŸ¥

### 2. ä¿®æ”¹æ–‡ä»¶

#### `src/components/CandlestickChart.tsx`
**ä¸»è¦å˜æ›´ï¼š**
1. âŒ åˆ é™¤äº† `generateCandlestickData()` æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå‡½æ•°
2. âœ… æ–°å¢çŠ¶æ€ç®¡ç†ï¼š
   - `candleData`: å­˜å‚¨çœŸå®Kçº¿æ•°æ®
   - `isLoading`: åŠ è½½çŠ¶æ€
   - `error`: é”™è¯¯ä¿¡æ¯
3. âœ… æ–°å¢ `useEffect` è°ƒç”¨APIè·å–æ•°æ®
4. âœ… å®Œå–„çš„åŠ è½½ã€é”™è¯¯ã€ç©ºæ•°æ®çŠ¶æ€å±•ç¤º

---

## ğŸ”„ æ•°æ®è·å–æµç¨‹

```
ç”¨æˆ·è¾“å…¥åˆçº¦åç§°ï¼ˆå¦‚ï¼šç»ç’ƒï¼‰
    â†“
Step 1: getMainContractList()
    è·å–æ‰€æœ‰ä¸»åŠ›åˆçº¦åˆ—è¡¨
    GET https://ftapi.10jqka.com.cn/futgwapi/api/market/v1/contract/getMainContractDetailList
    â†“
Step 2: matchContract()
    åŒ¹é…åˆçº¦ä¿¡æ¯
    æå– market å’Œ contractCode
    â†“
Step 3: æ„å»ºè¯·æ±‚å‚æ•°
    {
      "code_list": [{ "market": "67", "codes": ["FG2601"] }],
      "trade_date": -1,
      "trade_class": "intraday",
      "time_period": "day_1",
      "begin_time": "-30",
      "end_time": "0",
      "adjust_type": "forward",
      "data_fields": [8]
    }
    â†“
Step 4: fetchKlineData()
    POST https://quota-h.10jqka.com.cn/fuyao/futures_common_hq/quote/v1/single_kline
    Headers: X-Fuyao-Auth: basecomponent
    â†“
Step 5: transformKlineData()
    è½¬æ¢æ•°æ®æ ¼å¼ï¼š
    [æ—¶é—´æˆ³, å¼€ç›˜, æœ€é«˜, æœ€ä½, æ”¶ç›˜, æˆäº¤é‡, æˆäº¤é¢]
    â†“
    {x: timestamp, o: open, h: high, l: low, c: close}
    â†“
æ¸²æŸ“Kçº¿å›¾
```

---

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### APIè¿”å›æ ¼å¼
```typescript
{
  "status_code": 0,
  "data": {
    "quote_data": [{
      "market": "67",
      "code": "FG2601",
      "data_fields": ["1", "7", "8", "9", "11", "13", "19"],
      "value": [
        [timestamp, open, high, low, close, volume, amount],
        // ... æ›´å¤šæ•°æ®ç‚¹
      ]
    }]
  },
  "status_msg": "success"
}
```

### Chart.jséœ€è¦çš„æ ¼å¼
```typescript
{
  x: number,    // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
  o: number,    // å¼€ç›˜ä»· (Open)
  h: number,    // æœ€é«˜ä»· (High)
  l: number,    // æœ€ä½ä»· (Low)
  c: number     // æ”¶ç›˜ä»· (Close)
}
```

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### åŠ è½½çŠ¶æ€
```
â³ æ­£åœ¨åŠ è½½Kçº¿æ•°æ®...
```

### é”™è¯¯çŠ¶æ€
```
âŒ
æ— æ³•è·å–Kçº¿æ•°æ®
[å…·ä½“é”™è¯¯ä¿¡æ¯]
```

### ç©ºæ•°æ®çŠ¶æ€
```
æš‚æ— Kçº¿æ•°æ®
```

---

## ğŸ” ä½¿ç”¨ç¤ºä¾‹

### æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨ï¼ˆå·²é›†æˆåˆ°ç»„ä»¶ï¼‰
```tsx
// åªéœ€ä¼ å…¥åˆçº¦åç§°å³å¯
<CandlestickChart data={{
  contractName: 'ç»ç’ƒ',  // APIä¼šè‡ªåŠ¨åŒ¹é…å¹¶è·å–æ•°æ®
  contractCode: '2601',
  currentPrice: 1163,
  // ... å…¶ä»–å­—æ®µ
}} />
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨è°ƒç”¨API
```typescript
import { getKlineDataByContractName } from '../services/futuresApi';

// è·å–ç»ç’ƒçš„Kçº¿æ•°æ®
const klineData = await getKlineDataByContractName('ç»ç’ƒ');
console.log(klineData); // 30å¤©Kçº¿æ•°æ®
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### æ—¶é—´èŒƒå›´
å½“å‰å›ºå®šä¸º30å¤©æ•°æ®ï¼š
```typescript
begin_time: "-30"  // 30å¤©å‰
end_time: "0"      // ä»Šå¤©
```

å¦‚éœ€ä¿®æ”¹ï¼Œå¯åœ¨ `futuresApi.ts` çš„ `fetchKlineData()` å‡½æ•°ä¸­è°ƒæ•´å‚æ•°ã€‚

### æ•°æ®å­—æ®µ
å½“å‰è¯·æ±‚æ‰€æœ‰å­—æ®µï¼ˆ`data_fields: [8]`ï¼‰ï¼ŒåŒ…æ‹¬ï¼š
- æ—¶é—´æˆ³
- å¼€ç›˜ä»·ï¼ˆç´¢å¼•7ï¼‰
- æœ€é«˜ä»·ï¼ˆç´¢å¼•8ï¼‰
- æœ€ä½ä»·ï¼ˆç´¢å¼•9ï¼‰
- æ”¶ç›˜ä»·ï¼ˆç´¢å¼•11ï¼‰
- æˆäº¤é‡ï¼ˆç´¢å¼•13ï¼‰
- æˆäº¤é¢ï¼ˆç´¢å¼•19ï¼‰

---

## ğŸ› é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. åˆçº¦åç§°åŒ¹é…å¤±è´¥
**é”™è¯¯ä¿¡æ¯ï¼š**
```
æœªæ‰¾åˆ°åˆçº¦"XXX"ï¼Œè¯·æ£€æŸ¥åˆçº¦åç§°æ˜¯å¦æ­£ç¡®
```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥è¾“å…¥çš„åˆçº¦åç§°æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚ï¼šç»ç’ƒã€èºçº¹é’¢ã€é“œç­‰ï¼‰
- æŸ¥çœ‹ `matchContract()` å‡½æ•°çš„åŒ¹é…é€»è¾‘
- å¯ä»¥ä½¿ç”¨å“ç§ç®€ç§°ã€å“ç§åç§°æˆ–å“ç§ä»£ç 

#### 2. APIè¯·æ±‚å¤±è´¥
**é”™è¯¯ä¿¡æ¯ï¼š**
```
HTTPé”™è¯¯: 403 / 404 / 500
```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤APIåœ°å€æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ `X-Fuyao-Auth` headeræ˜¯å¦æ­£ç¡®

#### 3. è·¨åŸŸé—®é¢˜
å¦‚æœé‡åˆ°CORSé”™è¯¯ï¼Œéœ€è¦é…ç½®ä»£ç†ï¼š

**æ–¹æ³•1ï¼šåœ¨ `package.json` ä¸­æ·»åŠ ï¼š**
```json
{
  "proxy": "https://quota-h.10jqka.com.cn"
}
```

**æ–¹æ³•2ï¼šåˆ›å»º `src/setupProxy.js`ï¼š**
```javascript
const { createProxyMiddleware } = require('http-proxy-middleware');

module.exports = function(app) {
  app.use(
    '/fuyao',
    createProxyMiddleware({
      target: 'https://quota-h.10jqka.com.cn',
      changeOrigin: true,
    })
  );
};
```

---

## ğŸ“¦ ä¾èµ–è¯´æ˜

æœ¬æ¬¡æ›´æ–°æ²¡æœ‰æ·»åŠ æ–°çš„npmä¾èµ–ï¼Œä»…ä½¿ç”¨äº†ç°æœ‰çš„ï¼š
- `fetch API`ï¼ˆæµè§ˆå™¨åŸç”Ÿï¼‰
- `TypeScript`ï¼ˆé¡¹ç›®å·²æœ‰ï¼‰
- `React Hooks`ï¼ˆé¡¹ç›®å·²æœ‰ï¼‰

---

## ğŸ§ª æµ‹è¯•

### ç¼–è¯‘æµ‹è¯•
```bash
npm run build
```
âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— TypeScripté”™è¯¯

### å¼€å‘æµ‹è¯•
```bash
npm start
```
âœ… å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œè®¿é—® http://localhost:3000

### åŠŸèƒ½æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨åº”ç”¨
2. è¿›å…¥å•å“ç§åˆ†æé¡µé¢
3. è¾“å…¥åˆçº¦åç§°ï¼ˆå¦‚ï¼šç»ç’ƒï¼‰
4. è§‚å¯ŸKçº¿å›¾æ˜¯å¦åŠ è½½çœŸå®æ•°æ®
5. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼š
   ```
   å¼€å§‹è·å–Kçº¿æ•°æ®ï¼Œåˆçº¦åç§°: ç»ç’ƒ
   åŒ¹é…åˆ°åˆçº¦: {market: "67", contractCode: "FG2601", ...}
   æˆåŠŸè·å–30æ¡Kçº¿æ•°æ®
   ```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥**ï¼šå½“å‰ä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½è¯·æ±‚æœ€æ–°æ•°æ®
2. **è¯·æ±‚å–æ¶ˆ**ï¼šä½¿ç”¨ `isCancelled` æ ‡è®°é˜²æ­¢ç»„ä»¶å¸è½½åè®¾ç½®çŠ¶æ€
3. **ä¾èµ–ä¼˜åŒ–**ï¼šä»…åœ¨ `contractName` å˜åŒ–æ—¶é‡æ–°è¯·æ±‚æ•°æ®

---

## ğŸ”® æœªæ¥æ‰©å±•å»ºè®®

1. **ç¼“å­˜æœºåˆ¶**
   - æ·»åŠ  localStorage ç¼“å­˜
   - è®¾ç½®5åˆ†é’Ÿè¿‡æœŸæ—¶é—´

2. **æ—¶é—´èŒƒå›´é€‰æ‹©**
   - æ·»åŠ 7å¤©/30å¤©/90å¤©é€‰é¡¹
   - åŠ¨æ€è°ƒæ•´æ•°æ®ç‚¹æ•°é‡

3. **æ‰¹é‡è·å–**
   - å¤šå“ç§é¡µé¢æ‰¹é‡è·å–æ•°æ®
   - å¹¶å‘è¯·æ±‚ä¼˜åŒ–

4. **é‡è¯•æœºåˆ¶**
   - ç½‘ç»œé”™è¯¯æ—¶è‡ªåŠ¨é‡è¯•3æ¬¡
   - æŒ‡æ•°é€€é¿ç­–ç•¥

5. **æ•°æ®éªŒè¯**
   - æ ¡éªŒKçº¿æ•°æ®çš„å®Œæ•´æ€§
   - è¿‡æ»¤å¼‚å¸¸æ•°æ®ç‚¹

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯æ—¥å¿—
2. ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆå¼€å‘è€…å·¥å…· Network æ ‡ç­¾ï¼‰
3. APIè¿”å›çš„æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®

---

## âœ… æµ‹è¯•æ¸…å•

- [x] TypeScriptç±»å‹å®šä¹‰å®Œæ•´
- [x] APIè°ƒç”¨é€»è¾‘æ­£ç¡®
- [x] æ•°æ®è½¬æ¢å‡†ç¡®
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] åŠ è½½çŠ¶æ€å‹å¥½
- [x] ç¼–è¯‘æ— é”™è¯¯
- [x] å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] å®é™…APIè°ƒç”¨æµ‹è¯•ï¼ˆéœ€è¦ç½‘ç»œç¯å¢ƒï¼‰

---

**æ›´æ–°æ—¥æœŸï¼š** 2025-11-03
**ç‰ˆæœ¬ï¼š** v2.0.0
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ
